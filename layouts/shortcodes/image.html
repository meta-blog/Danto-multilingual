{{ $counter := add 1 (index .Page.Params "img_counter" | default 0) }}
{{ .Page.Scratch.Set "img_counter" $counter }}
{{ $image := .Page.Resources.GetMatch (.Get "src") }}
{{ $alt := .Get "alt" | default (printf "%s_%02d" .Page.Title $counter) }}
<figure class="lazyload">
  {{ with $image }}
    <img data-src="{{ .RelPermalink }}" 
         alt="{{ $alt }}"
         width="{{ .Width }}" 
         height="{{ .Height }}"
         class="lazy">
  {{ else }}
    <img data-src="{{ .Get "src" }}" 
         alt="{{ $alt }}"
         class="lazy">
  {{ end }}
  {{ with .Get "caption" }}
    <figcaption>{{ . }}</figcaption>
  {{ end }}
</figure>